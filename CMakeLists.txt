if (POLICY CMP0048)
    cmake_policy(SET CMP0048 NEW) # Allow project(xxx VERSION a.b.c)
endif()


project(fyaml LANGUAGES C VERSION 0.5.8)

cmake_minimum_required(VERSION 3.0)

# Must use GNUInstallDirs to install libraries into correct
# locations on all platforms.
include(GNUInstallDirs)

set(LIBHDRS
  src/valgrind/fy-valgrind.h
  src/xxhash/xxhash.h
  src/lib/fy-atom.h
  src/lib/fy-token.h
  src/lib/fy-accel.h
  src/lib/fy-utils.h
  src/lib/fy-dump.h
  src/lib/fy-doc.h
  src/lib/fy-input.h
  src/lib/fy-types.h
  src/lib/fy-typelist.h
  src/lib/fy-docstate.h
  src/lib/fy-parse.h
  src/lib/fy-emit.h
  src/lib/fy-event.h
  src/lib/fy-list.h
  src/lib/fy-utf8.h
  src/lib/fy-diag.h
  src/lib/fy-ctype.h
)
set(LIBSRCS
  src/lib/fy-input.c
  src/lib/fy-utils.c
  src/lib/fy-utf8.c
  src/lib/fy-ctype.c
  src/lib/fy-emit.c
  src/lib/fy-token.c
  src/lib/fy-docstate.c
  src/lib/fy-diag.c
  src/lib/fy-dump.c
  src/lib/fy-parse.c
  src/lib/fy-doc.c
  src/lib/fy-types.c
  src/lib/fy-atom.c
  src/lib/fy-accel.c
  src/xxhash/xxhash.c
)
set(LIBHDRSPUB
    include/libfyaml.h
)

add_library(${PROJECT_NAME}
    ${LIBHDRS}
    ${LIBSRCS}
    ${LIBHDRSPUB}
)

add_library(${PROJECT_NAME}::${PROJECT_NAME} ALIAS ${PROJECT_NAME})

set_target_properties(${PROJECT_NAME} PROPERTIES FOLDER "Libraries")

target_include_directories(${PROJECT_NAME}
    PUBLIC
        $<BUILD_INTERFACE:${${PROJECT_NAME}_SOURCE_DIR}/include>
        $<INSTALL_INTERFACE:include>
    PRIVATE
        ${${PROJECT_NAME}_SOURCE_DIR}/src/lib
        ${${PROJECT_NAME}_SOURCE_DIR}/src/lib/internal
        ${${PROJECT_NAME}_SOURCE_DIR}/src/xxhash
)

#target_link_libraries(${PROJECT_NAME} PUBLIC xx)
#target_compile_definitions(${PROJECT_NAME} PUBLIC xx)

target_compile_definitions(${PROJECT_NAME} PRIVATE
    VERSION="0.5.7.34"
)

target_compile_definitions(${PROJECT_NAME} PRIVATE
  $<$<NOT:$<CONFIG:DEBUG>>:NDEBUG>
)

# Shared options between GCC and CLANG:
if (NOT MSVC)
	target_compile_options(${PROJECT_NAME} PRIVATE
        -Wall
        -fPIC
        -D_GNU_SOURCE
    )

	if(NOT CMAKE_BUILD_TYPE STREQUAL "Debug")
		target_compile_options(${PROJECT_NAME} PRIVATE
            -O2
        )
	endif()
endif()
